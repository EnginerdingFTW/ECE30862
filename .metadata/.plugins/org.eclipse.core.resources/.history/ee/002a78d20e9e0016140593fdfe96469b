import java.util.Timer;
import java.math.*;

/**
    A Grub is a Creature that moves slowly on the ground.
*/
public class Grub extends Creature {

	private float reactionTime = 0.5f;
	private static TileMap map;
	private long playerDist = 50;
	private boolean shootingPlayer = false;
	private float FIRE_RATE = 2.5f;
	private Amunition ammo = new Amunition(FIRE_RATE);
	
    public Grub(Animation left, Animation right,
        Animation deadLeft, Animation deadRight)
    {
        super(left, right, deadLeft, deadRight);
    	Timer tim = new Timer();
		tim.schedule(new PlayerWatcher(), 0);
		System.out.println("created Grub");
    }
    
    public static void SetMap(TileMap m)
    {
    	map = m;
    }
    
    private void callShooting()
    {
    	ammo.shooting(this);
    }
    
    private class PlayerWatcher extends java.util.TimerTask
    {
	    public void run()
	    {
	    	boolean shootNext = false;
	    	while (true)
	    	{
	    		System.out.println("running playerWatch");
		    	try
		    	{
		    		Thread.sleep((long) (reactionTime * 1000));
		    	}
		    	catch (Exception e)
		    	{
		    		System.out.println("ERROR");
		    	}
		    	Player p = (Player)map.getPlayer();
		    	double distx = p.getX() - getX();
		    	double disty = p.getY() - getY();
		    	
		    	
		    	if (shootNext == true)
		    	{
		    		shootingPlayer = true;
		    		callShooting();
		    		//begin shooting player
//		    		break;
		    	}
		    	
		    	if ( distx < playerDist || disty < playerDist)
		    	{
		    		System.out.println("WITHIN DIST");
		    		if (shootingPlayer == false)
		    		{
		    			shootingPlayer = true;
		    			//begin shooting player
		    			callShooting();
//		    			break;
		    		}
		    	}
		    	else if (distx < playerDist + 100 || disty < playerDist + 100)
		    	{
		    		System.out.println("not close enough to fire immediately");
		    		if (shootingPlayer == false)
		    		{
		    			shootNext = true;
		    		}
		    	}
	    	}
	    }
    }


    public float getMaxSpeed() {
        return 0.05f;
    }

}
